### ECE568 Software Engineering II - Web Application HW4

Zhongze Tang (zt67)

### Q1

The XML file generated by (b) is Q1/q1a.xml.

(a) Please check Q1/q1a.dtd
```
<?xml version="1.0" encoding="UTF-8"?>
<!ELEMENT products (product*)>
<!ELEMENT product (name, price, description, store*)>
<!ELEMENT store (name, phones, markup)>

<!ELEMENT name (#PCDATA)>
<!ELEMENT price (#PCDATA)>
<!ELEMENT description (#PCDATA)>
<!ELEMENT phones (#PCDATA)>
<!ELEMENT markup (#PCDATA)>

<!ATTLIST product pid CDATA #REQUIRED>
<!ATTLIST store sid CDATA #REQUIRED>
```

(b) Please check Q1/q1b.xquery. It's result is Q1/q1a.xml.
```
<products>
{
    for $product in doc("q1b.xml")/db/products/row
    return
        <product pid="{$product/pid}">
            {$product/name}{$product/price}{$product/description}
            {
                for $store in doc("q1b.xml")/db/stores/row
                for $sell in doc("q1b.xml")/db/sells/row
                where $product/pid = $sell/pid and $store/sid = $sell/sid
                return
                <store sid="{$store/sid}">
                    {$store/name}{$store/phones}{$sell/markup}
                </store>

            }
        </product>
}
</products>
```

(c) Please check Q1/q1c.xquery
```
<products>
{
    for $product in doc("q1a.xml")/products/product
    where $product/store/markup = "25%"
    return
        <product>
            {$product/name} {$product/price}
        </product>
}
</products>
```

(d)
```sql
SELECT P.name, P.price
FROM product P, sell S
WHERE P.pid = S.pid
  AND S.markup = "25%"
GROUP BY P.name
```

### Q2

(a)
```
for $x in doc("q2.xml")/broadway//title
  return
    <result>
      {$x}
    </result>
```

(b)
```
for $x in doc("q2.xml")/broadway/theater[date = "11/9/2008"]
  where some $b in $x/price satisfies data($b) < 35
  return
    <theater>
      {$x/title}{$x/address}
    </theater>
```

(c)
```
for $x in doc("q2.xml")/broadway/concert[type = "chamber orchestra"]
  where avg(data($x/price))>=50
  return
  <result>
    {$x/title}
  </result>
```

(d)
```
for $d in distinct-values(doc("q2.xml")//date)
  for $x in //theater[date = $d] | //concert[date = $d] | //opera[date=$d]
    return
      <groupByDate>
            <day>
              {$d}
              <show>
                {$x/title}
                {$x/price}
              </show>
            </day>
      </groupByDate>
```

### Q3

Please check the Q3 folder for complete XML, XST and DTD files.

1)

modified XSL:
```html
<!--
  Change the sentence below both in bib/book and bib/article
  <xsl:value-of select="author"/>,
-->

<xsl:value-of select="author/last_name"/>,
<xsl:value-of select="author/first_name"/>.

<!--
  Under bib/book, change the things of publisher, address and year like this
-->

<!-- add brackets and spaces -->
(<xsl:value-of select="publisher"/>
<xsl:text> </xsl:text>
<xsl:value-of select="address"/>
<xsl:text> </xsl:text>
<xsl:value-of select="year"/>).

<!--
  Under bib/article, change the things of journal, volume and page like this
-->
<b><xsl:value-of select="journal"/>,
   <xsl:value-of select="volume"/></b>,
  pp.<xsl:apply-templates select="page"/>
```

modified XML:
```xml
<!--
  Change all the <author> labels from <author></author> to
  <author>
    <first_name></first_name>
    <last_name></last_name>
  </author>

  For example,
-->
<author>
    <first_name>Leslie</first_name>
    <last_name>Lamport</last_name>
</author>
```

The corressponding dtd file need to be changed as well:

```
  <!ELEMENT author (first_name, last_name)>
  <!ELEMENT first_name (#PCDATA) >
  <!ELEMENT last_name (#PCDATA) >
```

(2)
```xml
<book>
    <author>
        <first_name>Robert</first_name>
        <last_name>Kuhn</last_name>
    </author>
    <title>The Man Who Changed China: The Life and Legacy of Jiang Zemin</title>
    <year>2005</year>
    <address>China</address>
    <publisher>New York: Crown Publishers</publisher>
</book>

<book>
    <author>
        <first_name>Cixin</first_name>
        <last_name>Liu</last_name>
    </author>
    <title>The Three-Body Problem</title>
    <year>2008</year>
    <!-- publisher missed -->
</book>

<article>
    <author>
        <first_name>Khaled</first_name>
        <last_name>Almakadmeh</last_name>
    </author>
    <title>Towards a Reference Model of Software Resources Quality</title>
    <year>2018</year>
    <volume>14</volume>
    <page>
        <from>182</from>
        <to>198</to>
    </page>
    <journal>Journal of Computer Science</journal>
</article>

<article>
    <author>
        <first_name>Tao</first_name>
        <last_name>Xie</last_name>
    </author>
    <title>Preface</title>
    <year>2017</year>
    <!-- volume missed -->
    <page>
        <from>1057</from>
        <to>1059</to>
    </page>
    <journal>Journal of Computer Science and Technology</journal>
</article>

```

(3)

Added in XSL:
```html
<!--
  before
    </ul>
  </body>
-->
<xsl:for-each select="bib/phd_theses"> <p/>
    <li>
        <xsl:value-of select="author/last_name"/>,
        <xsl:value-of select="author/first_name"/>.
        <b><xsl:value-of select="title"/></b>,
        <xsl:value-of select="year"/>,
        <em><xsl:value-of select="university"/></em>.
    </li>
</xsl:for-each>
```

Added in XML:
```xml
<phd_theses>
   <author>
       <first_name>Thomas</first_name>
       <last_name>Dimiduk</last_name>
   </author>
   <title>Holographic Microscopy for Soft Matter and Biophysics</title>
   <year>2017</year>
   <university>Harvard University</university>
</phd_theses>

<phd_theses>
   <author>
       <first_name>Tim Allan</first_name>
       <last_name>Wheeler</last_name>
   </author>
   <title>Automotive safety validation in simulation</title>
   <year>2018</year>
   <university>Stanford University</university>
</phd_theses>
```

Modified in DTD:
```
<!ELEMENT bib ( (book | article | phd_theses)+)>
```

Added in DTD:
```
<!ELEMENT phd_theses (author, title, year, university) >
<!ELEMENT university (#PCDATA)>
```
